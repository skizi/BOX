<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Shader TEST</title>
    <script src="../../js/three.min.js"></script>


    <script type="x-shader/x-vertex" id="vshader">
      varying vec2 vUv;
 
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix *
                      vec4(position, 1.0);
      }
    </script>
 
    <script type="x-shader/x-fragment" id="fshader">
      uniform sampler2D tDiffuse;
      varying vec2 vUv;
 
      void main() {
        vec2 uv = vUv - vec2(0.5, 0.5);
        float l = length(uv)  * 2.0;
        uv *= 1.0 + sin(l*l * 40.0) * 0.2 * (1.0 - l);
        vec4 texel = texture2D( tDiffuse, uv + vec2(0.5, 0.5));
        gl_FragColor = texel * vec4( 0, 0, 1, 1 );
      }
    </script>
</head>
<body>

    <script>


        var scene;
        var renderer;
        var camera;



        scene = new THREE.Scene();

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;
        document.body.appendChild(renderer.domElement);

        var fov = 100;
        var aspect = window.innerWidth / window.innerHeight;
        camera = new THREE.PerspectiveCamera(fov, aspect, 1, 20000);
        camera.position.y = 150;
        camera.position.z = 200;
        camera.lookAt( new THREE.Vector3( 0, 100, 0 ) );



        var material = new THREE.ShaderMaterial({
            vertexShader: document.getElementById('vshader').textContent,
            fragmentShader: document.getElementById('fshader').textContent,
            
            uniforms: {
                /*time: { type: 'f', value: 0 },
                size: { type: 'f', value: 0.13 },
                color: { type: 'c', value: new THREE.Color(0xffcc88) },*/
                tDiffuse: { type: 't', value: THREE.ImageUtils.loadTexture('img/snow_negative_z.jpg') }
            },/*
            attributes: {
                lifetime: { type: 'f', value: [] },
                shift: { type: 'f', value: [] }
            },
            */
            blending: THREE.NoBlending, transparent: true, depthTest: false
        });




        var geometry = new THREE.SphereGeometry(100, 30, 30);
        var mesh = new THREE.Mesh(geometry, material);
        mesh.position.y = 150;
        mesh.castShadow  = true;
        scene.add(mesh);


        material = new THREE.MeshLambertMaterial({ color: 0xffffff });
        //material = new THREE.MeshBasicMaterial( { color:0xff0000, wireframe:true } );
        geometry = new THREE.PlaneGeometry( 400, 400, 5, 5 );
        mesh = new THREE.Mesh( geometry, material );
        mesh.rotation.x = 90 * 180 / Math.PI;
        mesh.receiveShadow = true;
        scene.add( mesh );
        
        var light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set( 0, 500, 0);
        light.castShadow = true;
        scene.add(light);

        animate();
        function animate() {

            requestAnimationFrame(animate);


            renderer.render(scene, camera);

        }


    </script>



</body>
</html>
